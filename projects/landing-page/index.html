<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Islamic Achievement Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .progress-bar-fill {
        transition: width 0.5s ease-in-out;
      }
      .task-card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      }
      .task-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .leaderboard-name {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    </style>
  </head>
  <body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
    <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
      <!-- Header -->
      <header class="text-center mb-8">
        <h1
          class="text-4xl sm:text-5xl font-bold text-emerald-600 dark:text-emerald-400"
        >
          Islamic Achievement Quest
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">
          Level up your Iman through righteous deeds
        </p>
      </header>

      <!-- User Profile & Progression -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8">
        <div class="flex flex-col sm:flex-row items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold" id="username-display">Player</h2>
            <p
              class="text-md text-emerald-500 dark:text-emerald-400 font-semibold"
              id="level-display"
            >
              Level 1: Fledgling Believer
            </p>
          </div>
          <div class="w-full sm:w-1/2 mt-4 sm:mt-0">
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
                >Experience</span
              >
              <span
                class="text-sm font-medium text-gray-700 dark:text-gray-300"
                id="xp-counter"
                >0 / 100 XP</span
              >
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4">
              <div
                id="xp-bar"
                class="bg-emerald-500 h-4 rounded-full progress-bar-fill"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>
        <div class="mt-4 text-center sm:text-left">
          <input
            type="text"
            id="username-input"
            placeholder="Enter your name"
            class="rounded-lg p-2 border bg-gray-50 dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
          <button
            id="save-name-btn"
            class="ml-2 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300"
          >
            Save Name
          </button>
        </div>
      </div>

      <!-- Main Content Tabs -->
      <div
        class="flex justify-center border-b border-gray-300 dark:border-gray-600 mb-6"
      >
        <button
          data-tab="tasks"
          class="tab-btn py-2 px-6 font-semibold text-emerald-600 dark:text-emerald-400 border-b-2 border-emerald-500"
        >
          Tasks
        </button>
        <button
          data-tab="rewards"
          class="tab-btn py-2 px-6 font-semibold text-gray-500 dark:text-gray-400"
        >
          Rewards
        </button>
        <button
          data-tab="leaderboard"
          class="tab-btn py-2 px-6 font-semibold text-gray-500 dark:text-gray-400"
        >
          Leaderboard
        </button>
      </div>

      <!-- Tasks Section -->
      <div id="tasks-content" class="tab-content">
        <h3 class="text-2xl font-bold mb-4 text-center">
          Daily & Weekly Deeds
        </h3>
        <div
          id="task-list"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Task cards will be injected here by JavaScript -->
        </div>
      </div>

      <!-- Rewards Section -->
      <div id="rewards-content" class="tab-content hidden">
        <h3 class="text-2xl font-bold mb-4 text-center">Unlocked Wisdom</h3>
        <div id="reward-list" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <!-- Reward items will be injected here -->
        </div>
      </div>

      <!-- Leaderboard Section -->
      <div id="leaderboard-content" class="tab-content hidden">
        <h3 class="text-2xl font-bold mb-4 text-center">Top Believers</h3>
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
          <table class="w-full text-left">
            <thead>
              <tr class="border-b dark:border-gray-600">
                <th class="p-2">Rank</th>
                <th class="p-2">Name</th>
                <th class="p-2">Level</th>
                <th class="p-2">XP</th>
              </tr>
            </thead>
            <tbody id="leaderboard-body">
              <!-- Leaderboard rows will be injected here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Toast Notification -->
      <div
        id="toast"
        class="fixed bottom-5 right-5 bg-emerald-500 text-white py-3 px-6 rounded-lg shadow-xl text-lg opacity-0 translate-y-10 transition-all duration-500"
      >
        Notification
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const app = {
          // STATE
          state: {
            username: "Player",
            level: 1,
            xp: 0,
            completedTasks: [],
            unlockedRewards: [],
          },

          // DATABASE
          levels: [
            { level: 1, name: "Fledgling Believer", xp_required: 0 },
            { level: 2, name: "Sincere Seeker", xp_required: 100 },
            { level: 3, name: "Mindful Worshipper", xp_required: 250 },
            { level: 4, name: "Generous Giver", xp_required: 500 },
            { level: 5, name: "Patient Soul", xp_required: 1000 },
            { level: 6, name: "Righteous Companion", xp_required: 2000 },
          ],
          tasks: [
            {
              id: 1,
              title: "Perform the 5 daily prayers",
              description: "Salah is a pillar of Islam.",
              xp: 20,
              type: "daily",
            },
            {
              id: 2,
              title: "Read a page of the Quran",
              description: "With understanding of its meaning.",
              xp: 15,
              type: "daily",
            },
            {
              id: 3,
              title: "Give charity (Sadaqah)",
              description: "Even a smile is a form of charity.",
              xp: 10,
              type: "daily",
            },
            {
              id: 4,
              title: "Make Dhikr 100 times",
              description: "Remember Allah throughout your day.",
              xp: 10,
              type: "daily",
            },
            {
              id: 5,
              title: "Visit or call a family member",
              description: "Maintaining kinship is a blessing.",
              xp: 25,
              type: "weekly",
            },
            {
              id: 6,
              title: "Attend Jumu'ah prayer",
              description: "The congregational Friday prayer.",
              xp: 50,
              type: "weekly",
            },
            {
              id: 7,
              title: "Learn a new Hadith",
              description:
                "Seek knowledge from the Prophet's (PBUH) teachings.",
              xp: 30,
              type: "weekly",
            },
            {
              id: 8,
              title: "Fast on a Monday or Thursday",
              description: "Follow the Sunnah of voluntary fasting.",
              xp: 40,
              type: "weekly",
            },
          ],
          rewards: [
            {
              level_unlocked: 2,
              title: "The Power of Du'a",
              content:
                "The Prophet (PBUH) said, 'Du'a (supplication) is the essence of worship.' - Tirmidhi. Your connection with Allah is strongest when you ask of Him.",
            },
            {
              level_unlocked: 3,
              title: "Wisdom on Charity",
              content:
                "The Prophet (PBUH) said, 'Charity does not decrease wealth.' - Muslim. Giving in the way of Allah only increases your blessings in this life and the next.",
            },
            {
              level_unlocked: 4,
              title: "The Virtue of Patience",
              content:
                "Allah says in the Quran, 'Indeed, the patient will be given their reward without account.' (39:10). Sabr (patience) is a key to paradise.",
            },
            {
              level_unlocked: 5,
              title: "Importance of Good Character",
              content:
                "The Prophet (PBUH) said, 'The heaviest of things that will be placed on the scale of a believer on the Day of Judgment is good character.' - Tirmidhi.",
            },
          ],
          leaderboardData: [
            { name: "Abdullah", level: 5, xp: 1500 },
            { name: "Fatima", level: 4, xp: 850 },
            { name: "Yusuf", level: 4, xp: 600 },
            { name: "Aisha", level: 3, xp: 400 },
            { name: "Omar", level: 2, xp: 150 },
          ],

          // DOM ELEMENTS
          ui: {
            usernameDisplay: document.getElementById("username-display"),
            usernameInput: document.getElementById("username-input"),
            saveNameBtn: document.getElementById("save-name-btn"),
            levelDisplay: document.getElementById("level-display"),
            xpCounter: document.getElementById("xp-counter"),
            xpBar: document.getElementById("xp-bar"),
            taskList: document.getElementById("task-list"),
            rewardList: document.getElementById("reward-list"),
            leaderboardBody: document.getElementById("leaderboard-body"),
            tabs: document.querySelectorAll(".tab-btn"),
            tabContents: document.querySelectorAll(".tab-content"),
            toast: document.getElementById("toast"),
          },

          init() {
            this.loadState();
            this.addEventListeners();
            this.renderAll();
          },

          addEventListeners() {
            this.ui.saveNameBtn.addEventListener("click", () =>
              this.updateUsername()
            );
            this.ui.taskList.addEventListener("click", (e) => {
              if (e.target.classList.contains("complete-btn")) {
                const taskId = parseInt(e.target.dataset.id);
                this.completeTask(taskId);
              }
            });
            this.ui.tabs.forEach((tab) => {
              tab.addEventListener("click", () =>
                this.switchTab(tab.dataset.tab)
              );
            });
          },

          // STATE MANAGEMENT
          saveState() {
            localStorage.setItem(
              "islamicQuestState",
              JSON.stringify(this.state)
            );
          },

          loadState() {
            const savedState = localStorage.getItem("islamicQuestState");
            if (savedState) {
              this.state = JSON.parse(savedState);
            }
          },

          // LOGIC
          addXp(amount) {
            this.state.xp += amount;
            this.showToast(`+${amount} XP earned!`);
            this.checkLevelUp();
            this.saveState();
            this.renderProgression();
            this.updateLeaderboard();
          },

          checkLevelUp() {
            const currentLevelInfo = this.levels[this.state.level - 1];
            const nextLevelInfo = this.levels[this.state.level];

            if (nextLevelInfo && this.state.xp >= nextLevelInfo.xp_required) {
              this.state.level++;
              this.showToast(
                `Level Up! You are now a ${
                  this.levels[this.state.level - 1].name
                }!`,
                "level-up"
              );
              this.unlockRewards();
              this.renderRewards();
            }
          },

          unlockRewards() {
            this.rewards.forEach((reward) => {
              if (
                this.state.level >= reward.level_unlocked &&
                !this.state.unlockedRewards.includes(reward.title)
              ) {
                this.state.unlockedRewards.push(reward.title);
                this.showToast(`New Wisdom Unlocked: ${reward.title}`);
              }
            });
          },

          completeTask(taskId) {
            if (this.state.completedTasks.includes(taskId)) {
              this.showToast("You've already completed this task.", "error");
              return;
            }
            const task = this.tasks.find((t) => t.id === taskId);
            if (task) {
              this.state.completedTasks.push(taskId);
              this.addXp(task.xp);
              this.renderTasks();
            }
          },

          updateUsername() {
            const newName = this.ui.usernameInput.value.trim();
            if (newName) {
              this.state.username = newName;
              this.ui.usernameInput.value = "";
              this.saveState();
              this.renderProgression();
              this.updateLeaderboard();
              this.showToast("Username updated!");
            }
          },

          updateLeaderboard() {
            // Remove old player entry if exists
            this.leaderboardData = this.leaderboardData.filter(
              (p) => p.isPlayer !== true
            );
            // Add current player's data
            this.leaderboardData.push({
              name: this.state.username,
              level: this.state.level,
              xp: this.state.xp,
              isPlayer: true,
            });
            // Sort by level then xp
            this.leaderboardData.sort(
              (a, b) => b.level - a.level || b.xp - a.xp
            );
            this.renderLeaderboard();
          },

          // RENDER FUNCTIONS
          renderAll() {
            this.renderProgression();
            this.renderTasks();
            this.unlockRewards(); // Ensure rewards are checked on load
            this.renderRewards();
            this.updateLeaderboard(); // initial sort and render
          },

          renderProgression() {
            this.ui.usernameDisplay.textContent = this.state.username;
            const currentLevelInfo = this.levels[this.state.level - 1];
            const nextLevelInfo = this.levels[this.state.level] || {
              xp_required: this.state.xp,
            };

            this.ui.levelDisplay.textContent = `Level ${currentLevelInfo.level}: ${currentLevelInfo.name}`;

            const xpForCurrentLevel =
              this.state.xp - currentLevelInfo.xp_required;
            const xpToNextLevel =
              nextLevelInfo.xp_required - currentLevelInfo.xp_required;

            this.ui.xpCounter.textContent = `${this.state.xp} / ${nextLevelInfo.xp_required} XP`;
            const progressPercentage =
              xpToNextLevel > 0
                ? (xpForCurrentLevel / xpToNextLevel) * 100
                : 100;
            this.ui.xpBar.style.width = `${Math.min(100, progressPercentage)}%`;
          },

          renderTasks() {
            this.ui.taskList.innerHTML = "";
            this.tasks.forEach((task) => {
              const isCompleted = this.state.completedTasks.includes(task.id);
              const taskCard = `
                            <div class="task-card bg-white dark:bg-gray-800 rounded-xl shadow-md p-5 flex flex-col justify-between">
                                <div>
                                    <span class="inline-block bg-${
                                      task.type === "daily" ? "blue" : "purple"
                                    }-200 text-${
                task.type === "daily" ? "blue" : "purple"
              }-800 text-xs px-2 rounded-full uppercase font-semibold tracking-wide">${
                task.type
              }</span>
                                    <h4 class="font-bold text-lg mt-2">${
                                      task.title
                                    }</h4>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm mt-1">${
                                      task.description
                                    }</p>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <span class="font-semibold text-emerald-500">${
                                      task.xp
                                    } XP</span>
                                    <button data-id="${
                                      task.id
                                    }" class="complete-btn ${
                isCompleted
                  ? "bg-gray-400 cursor-not-allowed"
                  : "bg-emerald-500 hover:bg-emerald-600"
              } text-white font-bold py-2 px-4 rounded-lg transition duration-300" ${
                isCompleted ? "disabled" : ""
              }>
                                        ${isCompleted ? "Done" : "Complete"}
                                    </button>
                                </div>
                            </div>
                        `;
              this.ui.taskList.innerHTML += taskCard;
            });
          },

          renderRewards() {
            this.ui.rewardList.innerHTML = "";
            if (this.state.unlockedRewards.length === 0) {
              this.ui.rewardList.innerHTML = `<p class="text-center text-gray-500 col-span-full">Level up to unlock wisdom and rewards!</p>`;
              return;
            }

            this.rewards.forEach((reward) => {
              const isUnlocked = this.state.unlockedRewards.includes(
                reward.title
              );
              if (isUnlocked) {
                const rewardItem = `
                                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                                    <h4 class="font-bold text-xl text-emerald-600 dark:text-emerald-400">${reward.title}</h4>
                                    <p class="text-gray-700 dark:text-gray-300 mt-2">${reward.content}</p>
                                </div>
                            `;
                this.ui.rewardList.innerHTML += rewardItem;
              }
            });
          },

          renderLeaderboard() {
            this.ui.leaderboardBody.innerHTML = "";
            this.leaderboardData.forEach((player, index) => {
              const isCurrentUser = player.isPlayer;
              const rankIcons = ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"];
              const rankDisplay =
                index < 3 ? rankIcons[index] : `#${index + 1}`;
              const rowClass = isCurrentUser
                ? "bg-emerald-100 dark:bg-emerald-900 font-bold"
                : "";

              const row = `
                            <tr class="${rowClass}">
                                <td class="p-3">${rankDisplay}</td>
                                <td class="p-3 leaderboard-name">${player.name}</td>
                                <td class="p-3">${player.level}</td>
                                <td class="p-3">${player.xp}</td>
                            </tr>
                        `;
              this.ui.leaderboardBody.innerHTML += row;
            });
          },

          // UI HELPERS
          switchTab(tabName) {
            this.ui.tabContents.forEach((content) => {
              content.classList.add("hidden");
            });
            document
              .getElementById(`${tabName}-content`)
              .classList.remove("hidden");

            this.ui.tabs.forEach((tab) => {
              if (tab.dataset.tab === tabName) {
                tab.classList.add(
                  "text-emerald-600",
                  "dark:text-emerald-400",
                  "border-emerald-500"
                );
                tab.classList.remove("text-gray-500", "dark:text-gray-400");
              } else {
                tab.classList.remove(
                  "text-emerald-600",
                  "dark:text-emerald-400",
                  "border-emerald-500"
                );
                tab.classList.add("text-gray-500", "dark:text-gray-400");
              }
            });
          },

          showToast(message, type = "success") {
            const toast = this.ui.toast;
            toast.textContent = message;

            // Reset classes
            toast.classList.remove(
              "bg-emerald-500",
              "bg-red-500",
              "opacity-0",
              "translate-y-10"
            );

            if (type === "error") {
              toast.classList.add("bg-red-500");
            } else {
              toast.classList.add("bg-emerald-500");
            }

            toast.classList.remove("opacity-0", "translate-y-10");

            setTimeout(() => {
              toast.classList.add("opacity-0", "translate-y-10");
            }, 3000);
          },
        };

        app.init();
      });
    </script>
  </body>
</html>
